<html>
  <title>Blog on Sketchpad14: Part II</title>
  <head>
    <link href="./lib/prism.css" rel="stylesheet" />
    <link href="index.css" rel="stylesheet"></link>
  </head>
  </style>
<body>
  <script src="./lib/prism.js"></script>
  <hd>Half-Century Later:
    <br>
    "From Sketchpad<small>61</small> to Sketchpad<small>14</small>"
    <br>
    <small>
      Part II: Using Sketchpad<small>14</small> with Predefined Types
    </small>
  </hd>
  <br><br>
  <small><a href="http://www.hesam.us">Hesam Samimi</a>, <a href="http://www.tinlizzie.org/~awarth">Alex Warth</a><br><a href="http://www.cdglabs.org">Communication Design Group</a></small>
  <br><br>
  <img src="1.png"></img>
  <br>
  <hd1>54 Years Later: Sketchpad<small>14</small></hd1>
  <div class="chapter">
    <p>
      Overveld's alternative relaxation constraint solving approach for the geometric constraints a la Sketchpad inspired us to build a fully general programming model around it. We call it Sketchpad<small>14</small>. Our intention was to go back and honor and implement most of the cool things about Sutherland's Sketchpad, yet build a realistic system to build interactive web applications. 
    </p>
    <p>
      As in Sketchpad and Overveld's geometric constraints, the way to define and modify the behavior of a program is to add/remove constraints, rather than the common imperative programming practice of "writing code." We take Overveld's approach, however, and require that constraint types be defined beforehand. This means we let the user define constraint types as well as how to solve them in isolation. This is what's empowering about the approach as the user is put in the driver seat to use the programming language of the program itself to define the constraint and also provide an "algorithm" to solve it.
    </p>
    <p>
      Another aspect of Sketchpad<small>14</small> is that it gives a principled mechanism for the user to define the <i>reactive</i> part of an interactive program. The next section explains a semi-formal programming model implemented by the tool that we call <i>Constraint Reactive Programming</i>.
    </p>
  </div>
  <img src="1.png"></img>
  <br>
  <hd1>Constraint Reactive Programming</hd1>
  <div class="chapter">
    <p>
      Sketchpad<small>14</small> is hosted in JavaScript, so we will explain the Constraint Reactive Programming (CRP) model in the context of the JS language.
    </p>
    In this language, primitive types as well as functions and objects serve as values. Objects can be instantiated and referenced, as usual. However, imperative style programming, e.g. assignments for computation, isn't done.
    <p>
      Constructing a program in the CRP model involves describing four parts:
      <ul>
      <li>
      (1) data and constraint class definitions
      </li>
      <li>
      (2) data, as instances of data classes
      </li>
      <li>
	(3) continuous behaviors given in terms of constraints operating over the data, as instances of constraint classes
      </li>
      <li>
	(4) discrete behaviors, that is, the definition of events.
      </li>
      </ul>
    </p>
    <p>
      An <i>event</i> is defined by:
      <ul>
      <li>
	(a) a trigger, e.g. a IO event or a predicate over the state
      </li>
      <li>
	(b) a handler method describing the changes that need to occur anytime the event is triggered
      </li>
    </p>
      <p>
      The model restricts what can be done in a handler, and it will be primarily used to add/remove data or continuous constraints to/from the store. Another thing that can occur in the event handler is a <i>discrete constraint</i>, i.e. one that is only solved once at the time even is triggered, but it doesn't get added to the store unlike the continuous constraints.
    </p>
    <p>
Therefore, the execution model is unlike the imperative style, i.e., statement by statement. The program is assumed to be <i>reactive</i>. All present constraints are assumed to be continuously operating over the data, affecting them any time they are left unsatisfied. The events are always assumed to be ready to be triggered.
    </p>
    <p>
      OK, enought talking! Let's jump to our first example.
    </p>
  </div>
  <img src="1.png"></img>
  <br>
  <hd1>First Example: CDG Logo</hd1>
  <div class="chapter">
    <table>
      <tr>
	<td><img src="2.gif"></img></td>
	<td><p class="side">CDG Logo Demo</p></td>
      </tr>
    </table>
    <p>
      Consider the program above that displays our group (CDG)'s interim logo, which consists of three points and two line sections. This is a reactive application. The user can drag one of these objects around, however, the structure of the logo needs to be maintained.
    </p>
    <p>
      Sketchpad<small>14</small> allows the user to define new data or constraint types. However, it does come with a set of standard shapes and constraint types, which we will make use of here. To capture this program, we instantiate three <mono>Point</mono>s and two <mono>Line</mono>s with the correct radius, text, color, etc. to match the figure below. 
    </p>
    <pre><code class="language-javascript">

	p1 := new Point(...); //C
	p2 := new Point(...); //D
	p3 := new Point(...); //G
	l1 := new Line(p1, p2);
	l2 := new Line(p2, p3);
    </code></pre>
    <p>
      The next step is to add the continuous behaviors, i.e., constraints. We will add two <mono>LengthConstraint</mono>s to keep the lengths of lines fixed at 100px and one <mono>OrientationConstraint</mono> to keep the angle between them at 90 degrees, at all times:
    </p>
    <pre><code class="language-javascript">

	addConstraint(new LengthConstraint(p1, p2, 100))
	addConstraint(new LengthConstraint(p2, p3, 100))
	addConstraint(new OrientationConstraint(p2, p1, p2, 3,  Math.PI / 2))
    </code></pre>
    <p>
      Finally, we need to define the reactive aspect of the program: if the user has the mouse clicked on an object, we'd want to add a <mono>CoordinateConstraint</mono> to also require that it follows the mouse dragging:
    </p>
    <pre><code class="language-javascript">

    registerEvent('mousedown', function(e) {
    if (typeof e.pointedObject = Point)
        dragConstraint = addConstraint(
            new CoordinateConstraint(e.pointedObject, e.mousePosition))
})
    </code></pre>
    <p>
      The <mono>registerEvent</mono> call internally installs a JavaScript event listener, yet ensures the callback is invoked at appropriate times (not during solving of constraints) rather than haphazardly. We'll get to details later.
    </p>
    <p>
      And the <mono>CoordinateConstraint</mono> needs to be updated during the dragging:
    </p>
    <pre><code class="language-javascript">

    registerEvent('mousemove', function(e) {
    if (dragConstraint !== undefined)
        dragConstraint.c = e.mousePosition
})
    </code></pre>
        <p>
      And finally the drag constraint is removed when the user releases the mouse. 
    </p>
    <pre><code class="language-javascript">

    registerEvent('mouseup', function(e) {
    if (dragConstraint !== undefined) {
        removeConstraint(dragConstraint)
        dragConstraint = undefined
    }
})
    </code></pre>
  </div>
  <img src="1.png"></img>
  <br>
  <hd1>Exploring A Program's Behavior</hd1>
  <div class="chapter">
    <p>
      In the demo figure above we saw the a feature that helps understanding a program: the set of active constraints are shown at the top right of the screen. Notice that the one <mono>CoordinateConstraint</mono> temporarily appears during the user dragging event. The number of instances of each constraint type is also shown.
    </p>
    <table>
      <tr>
	<td><img src="2.gif"></img></td>
	<td><p class="side">Seeing the set of active constraints</p></td>
      </tr>
    </table>
    <p>
      To quickly explore each constraint, we can click on the number of instances to get a list of individual constraints. Hovering over each individual constraint will highlight the objects involved in the constraint:
    </p>
    <table>
      <tr>
	<td><img src="3.gif"></img></td>
	<td><p class="side" style="margin-left: 40%">Viewing involved objects in a constraint</p></td>
      </tr>
    </table>
    <p>
      To explore each constraint in more detail, we can click on the individual constraint to get an <i>inspector</i> on it:
    </p>
    <table>
      <tr>
	<td><img src="4.gif" style="margin-left: -25%"></img></td>
	<td><p class="side" style="margin-left: -30%">Inspecting a constraint + constraint summary</p></td>
      </tr>
    </table>
    <p>
      The inspector has several features. The properties belonging to the object (in this case the constraint) are listed. For those properties which are objects (in this case <mono>Point</mono>s p1 and p2), pointer arrows are drawn to the objects in the scene. Note that properties of objects are typed.
    </p>
    <p>
      Another feature is an English sentence summarizing the constraint. In the figure above it reads <i>"points p1 & p2 always maintain a distance of 110."</i> We'll get into how these are generated later. 
    </p>
    <p>
      Inspector can be used to modify the properties of the inspected object (here the constraint). For example, in the animated figure below we modify one of the required angle between the two lines sections:
    </p>
    <table>
      <tr>
	<td><img src="5.gif" style="margin-left: -25%"></img></td>
	<td><p class="side"  style="margin-left: -35%">Modifying a primitive value in a constraint using the inspector</p></td>
      </tr>
    </table>
    <p>
      We can also modify the object properties of the inspected constraint or object. For example, in the animated figure below we modify one of the length constraints by changing one of the points it operates on. Notice that when each listed property is clicked on, all compatible values (of same type) in the scene are highlighted. By clicking on one of them we can change the property to point to the clicked object (this is done using a concept in Sketchpad called <i>merging</i>, we'll visit it later):
    </p>
    <table>
      <tr>
	<td><img src="6.gif" style="margin-left: -30%"></img></td>
	<td><p class="side"  style="margin-left: -60%">Modifying an object property in a constraint using the inspector</p></td>
      </tr>
    </table>
    <p>
      To explore and understand a program and its behaviors, we may wish to turn on and off constraints to see the change in behavior:
    </p>
    <table>
      <tr>
	<td><img src="7.gif" style="margin-left: -0%"></img></td>
	<td><p class="side"  style="margin-left: 15%">Mix-n-matching behaviors</p></td>
      </tr>
    </table>
    <p>
      Sketchpad<small>14</small> can generate a whole English summary of the program. This involves giving a parameterized description of each involved constraint type, as well as a summary of individual active constraints as we showed before, along with a listing of existing objects and their states, and finally the set of active events. The figure below shows the constraints portion of the summary:
    </p>
    <table>
      <tr>
	<td><img src="8.gif" style="margin-left: -10%"></img></td>
	<td><p class="side"  style="margin-left: -25%">Viewing a program summary</p></td>
      </tr>
    </table>
  </div>
  <p>
    Read <a href="3.html">Part III: Using Sketchpad<small>14</small> with Custom Types</a><br>
    Back to <a href="index.html">Table of Contents</a><br>
    Try <a href="../index.html">Sketchpad<small>14</small></a>
 </p>
</body>
</html>
